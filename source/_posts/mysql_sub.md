---
title: 关于分库分表的总结记录
date: 2023-03-15 15:11:41
tags: MySQL
categories:
- 技术笔记
- MySQL
  banner_img: https://cdn.wallpaperhub.app/cloudcache/e/9/e/a/3/d/e9ea3d767d495faba38e5a96d3502856b93480ec.jpg
  index_img: https://cdn.wallpaperhub.app/cloudcache/5/0/a/f/d/5/50afd52a90520bd017bee5d6e0fc416665e8f048.jpg
---

### 什么时候分库分表

- 分库
  - 磁盘读IO瓶颈，热点数据太多，数据库缓存放不下，每次查询时会产生大量的IO，降低查询速度 -> 分库和垂直分表。
  - 网络IO瓶颈，请求的数据太多，网络带宽不够 -> 分库
- 分表
  - 单表数据量太大，查询时扫描的行太多，SQL效率低，CPU率先出现瓶颈 -> 水平分表

### 概念
- 水平分表
  - 概念：以字段为依据，按照一定策略（hash、range等），将一个表中的数据拆分到多个表中
  - 结果：每个表的结构都一样、每个表的数据都不一样，没有交集、所有表的并集是全量数据
  - 场景：系统绝对并发量并没有上来，只是单表的数据量太多，影响了SQL效率，加重了CPU负担，以至于成为瓶颈
  - 分析：表的数据量少了，单次SQL执行效率高，自然减轻了CPU的负担
- 水平分库
  - 概念：以字段为依据，按照一定策略（hash、range等），将一个库中的数据拆分到多个表中
  - 结果：每个库的结构都一样、每个库的数据都不一样，没有交集、所有库的并集是全量数据
  - 场景：系统绝对并发量上来了，分表难以根本上解决问题，并且还没有明显的业务归属来垂直分库
  - 分析：库多了，io和cpu的压力自然可以成倍缓解
- 垂直分库
  - 概念：以表为依据，按照业务归属不同，将不同的表拆分到不同的库中
  - 结果：每个库的结构都不一样、每个库的数据都不一样，没有交集、所有库的并集是全量数据
  - 场景：系统绝对并发量上来了并且可以抽象出单独的业务模块
  - 分析：可以对单库服务化
- 垂直分表
  - 概念：以字段为依据，按照字段的活跃性，将表中字段拆到不同的表（主表和扩展表）中
  - 结果： 每个表的结构都不一样、一般来说，每个表的字段至少有一列交集，一般是主键，用于关联数据、所有表的并集是全量数据
  - 场景：系统绝对并发量并没有上来，表的记录并不多，但是字段多，并且热点数据和非热点数据在一起，单行数据所需的存储空间较大。以至于数据库缓存的数据行减少，查询时会去读磁盘数据产生大量的随机读IO，产生IO瓶颈
  - 分析：垂直分表的拆分原则是将热点数据（可能会冗余经常一起查询的数据）放在一起作为主表，非热点数据放在一起作为扩展表。这样更多的热点数据就能被缓存下来，进而减少了随机读IO



